{% extends 'dreamstone/base.html.twig' %}

{% block body %}
    <div class="box box-info">
        <div class="box-body">
            <div class="row">
                <div class="col-xs-12">
                    <form class="form">
                        <div class="row">
                            <div class="col-xs-2">
                                <div class="form-group">
                                    <label for="datetime-from">{{ "date_from"|trans }}</label>
                                    <input type="datetime" id="datetime-from" class="datepicker form-control" name="from" value="{{ from != '' ? from|date('d/m/Y') : '' }}">
                                </div>
                            </div>
                            <div class="col-xs-2">
                                <div class="form-group">
                                    <label for="datetime-to">{{ "date_to"|trans }}</label>
                                    <input type="datetime" id="datetime-to" class="datepicker form-control" name="to" value="{{ to != '' ? to|date('d/m/Y') : '' }}">
                                </div>
                            </div>
                            <div class="col-xs-1">
                                <label>&nbsp;</label><br>
                                <button type="submit" class="btn btn-default pull-left">{{ "filter"|trans }}</button>
                            </div>

                            <div class="col-xs-1">
                                <label>&nbsp;</label><br>
                                <a href="{{ path('posts-report', {id: post.id}) }}" class="btn btn-default pull-left">{{ "clear_filters"|trans }}</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12 col-sm-3 col-md-2">
            <div class="panel panel-info text-center">
                <div class="panel-heading">
                    {{ "total_reads"|trans }}
                </div>
                <div class="panel-body text-center">
                    <h1>{{ totalReads }}</h1>
                </div>
            </div>
        </div>
        <div class="col-xs-12 col-sm-3 col-md-2">
            <div class="panel panel-info text-center">
                <div class="panel-heading">
                    {{ "unique_users"|trans }}
                </div>
                <div class="panel-body text-center">
                    <h1>{{ uniqueReads }}</h1>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12">
{% if reportReads != '' %}
            <canvas id="report" width="400"></canvas>
{% else %}
            <div class="alert alert-warning text-center">{{ "message_insufficient_data"|trans }}</div>
{% endif %}
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script src="{{ asset('assets/bower/chart.js/dist/Chart.js') }}"></script>
    <script>
        $(document).ready(function() {
            var ctx = $('#report');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['{{ reportDates|raw }}'],
                    datasets: [{
                        label: 'Reads',
                        data: [{{ reportReads }}],
                        backgroundColor: 'rgba(145,220,0,0.3)',
                        borderColor: 'rgb(145,220,0)'
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                userCallback: function(label) {
                                    if (Math.floor(label) === label) {
                                        return label;
                                    }

                                },
                            }
                        }],
                    },
                }
            });
        });
    </script>
{% endblock %}
